# CategoryRAG文档格式支持说明

## 📋 支持的文档格式

CategoryRAG系统支持多种文档格式，但不同格式的处理流程略有差异：

### ✅ 完全支持的格式

| 格式 | 扩展名 | 文档转换 | 智能分块 | TOC提取 | 向量化 | 检索 |
|------|--------|----------|----------|---------|--------|------|
| **PDF文档** | `.pdf` | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Word文档** | `.docx`, `.doc` | ✅ | ✅ | ✅ | ✅ | ✅ |

### ⚠️ 部分支持的格式

| 格式 | 扩展名 | 文档转换 | 智能分块 | TOC提取 | 向量化 | 检索 |
|------|--------|----------|----------|---------|--------|------|
| **Excel文档** | `.xlsx`, `.xls` | ❌ | ✅ | ❌ | ✅ | ✅ |

## 🔍 功能详解

### 1. 文档转换
- **支持**: PDF、Word文档
- **不支持**: Excel文档（直接进行分块处理）
- **工具**: GROBID服务（PDF）、MarkItDown（Word）

### 2. 智能分块
- **支持**: 所有格式
- **策略**:
  - PDF/Word文档：按语义分块（500-1000字符/块）
  - Excel文档：按行数分块（默认40行/块）

### 3. TOC提取
- **支持**: PDF、Word文档
- **不支持**: Excel文档
- **原因**: Excel文档通常没有明确的目录结构
- **影响**: 不影响文档的正常检索功能，仅影响查询增强功能

### 4. 向量化和检索
- **支持**: 所有格式
- **模型**: BGE-large-zh-v1.5
- **存储**: ChromaDB向量数据库

## 📝 处理流程对比

### PDF/Word文档处理流程
```
原始文档 → GROBID/MarkItDown转换 → Markdown格式 → 智能分块 → TOC提取 → 向量化 → 存储
```

### Excel文档处理流程
```
原始文档 → 直接分块 → (跳过TOC提取) → 向量化 → 存储
```

## 🎯 最佳实践建议

### 1. 文档格式选择
- **推荐**: PDF或Word格式，可获得完整功能支持
- **可用**: Excel格式，适合表格数据

### 2. 文档质量要求
- **PDF**: 确保为可搜索的文本格式（非扫描图片）
- **Word**: 使用标准的标题样式，便于TOC提取
- **Excel**: 确保数据结构清晰，有明确的表头

### 3. 文档大小限制
- **建议**: 单个文档不超过50MB
- **原因**: 大文档会影响处理速度和内存使用
- **解决**: 可将大文档拆分为多个小文档

## ⚙️ 配置说明

### TOC提取配置
```yaml
# config/config.yaml
toc_extraction:
  enabled: true
  supported_formats: [".pdf", ".docx", ".doc"]
  skip_formats: [".xlsx", ".xls"]
```

### 分块配置
```yaml
# 文本分块配置
text_chunking:
  chunk_size: 1000
  overlap_size: 200

# Excel分块配置  
excel_chunking:
  rows_per_chunk: 40
```

## 🔧 故障排除

### 问题1: TOC提取失败
- **现象**: Excel或文本文档显示"跳过TOC提取"
- **原因**: 这些格式不支持TOC提取
- **解决**: 这是正常行为，不影响文档检索功能

### 问题2: PDF处理失败
- **现象**: PDF文档转换失败
- **原因**: 可能是扫描版PDF或GROBID服务未启动
- **解决**: 
  ```bash
  # 启动GROBID服务
  docker run --rm -d -p 8070:8070 lfoppiano/grobid:0.8.0
  ```

### 问题3: Excel分块异常
- **现象**: Excel文档分块数量异常
- **原因**: 表格结构复杂或包含合并单元格
- **解决**: 简化表格结构，避免复杂的合并单元格

## 📊 性能对比

| 格式 | 处理速度 | 内存占用 | 检索质量 | 查询增强 |
|------|----------|----------|----------|----------|
| PDF | 中等 | 中等 | 高 | 支持 |
| Word | 快 | 低 | 高 | 支持 |
| Excel | 快 | 低 | 中等 | 不支持 |

## 🎉 总结

- **完整功能**: 选择PDF或Word格式
- **表格数据**: 选择Excel格式
- **TOC增强**: 仅PDF和Word文档支持
- **检索功能**: 所有支持的格式均可检索

CategoryRAG专注于支持最常用的办公文档格式，确保高质量的文档处理和检索体验。
