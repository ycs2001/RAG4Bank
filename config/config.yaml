# RAGæ£€ç´¢é—®ç­”ç³»ç»Ÿé…ç½®æ–‡ä»¶

# è°ƒè¯•é…ç½®
debug:
  enabled: false  # ç”Ÿäº§ç¯å¢ƒé»˜è®¤å…³é—­
  output_dir: "./debug_retrieval"
  save_raw_chunks: true
  save_context: true
  save_llm_responses: true
 

# ç³»ç»ŸåŸºæœ¬é…ç½®
system:
  name: "RAGæ™ºèƒ½é—®ç­”ç³»ç»Ÿ"
  version: "2.0.0"
  description: "é‡‘èç›‘ç®¡é¢†åŸŸæ™ºèƒ½é—®ç­”ç³»ç»Ÿ"
  log_level: "INFO"
  log_file: "logs/rag_system.log"

# å‘é‡æ£€ç´¢é…ç½®
retrieval:
  # æ£€ç´¢ç­–ç•¥ï¼šsingle_collectionï¼ˆå•åº“ï¼‰æˆ– multi_collectionï¼ˆå¤šåº“ï¼‰
  strategy: "multi_collection"

  # é»˜è®¤æ£€ç´¢å™¨ç±»å‹
  default_retriever: "chromadb"

  # æ£€ç´¢å‚æ•°
  top_k: 20  # æ¯ä¸ªåº“çš„æ£€ç´¢æ•°é‡ï¼ˆå¢åŠ ä»¥è·å–æ›´å¤šç›¸å…³å†…å®¹ç”¨äºé‡æ’ï¼‰
  similarity_threshold: 0.5  # è¿›ä¸€æ­¥æé«˜ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œè¿‡æ»¤è¾¹ç¼˜ç›¸å…³å†…å®¹
  max_context_length: 16000  # å¢åŠ ä¸Šä¸‹æ–‡é•¿åº¦ä»¥é¿å…æˆªæ–­

  # ä¸»é¢˜åˆ†ç±»é…ç½®
  topic_classification:
    enabled: true
    confidence_threshold: 0.3  # é™ä½é˜ˆå€¼ï¼Œæé«˜åˆ†ç±»æˆåŠŸç‡
    fallback_to_global: false  # ç¦ç”¨å…¨å±€æ£€ç´¢å›é€€
    max_collections: 3  # æœ€å¤šåŒæ—¶æ£€ç´¢çš„åº“æ•°é‡

    # ç‰ˆæœ¬å¤„ç†é…ç½®
    version_handling:
      enabled: true
      default_strategy: "prefer_latest"  # prefer_latest | ask_user | include_all
      ask_user_on_ambiguity: true

      # ç‰ˆæœ¬ç»„é…ç½®ï¼ˆç”¨äºç‰ˆæœ¬å¯¹æ¯”ï¼‰
      version_groups:
        "1104æŠ¥è¡¨":
          collections: ["report_1104_2024", "report_1104_2022"]
          latest: "report_1104_2024"
          description: "é“¶è¡Œä¸šç›‘ç®¡ç»Ÿè®¡æŠ¥è¡¨åˆ¶åº¦"
        "EASTç³»ç»Ÿ":
          collections: ["east_data_structure", "east_metadata"]
          latest: "east_data_structure"
          description: "EASTç›‘ç®¡æ•°æ®æŠ¥é€ç³»ç»Ÿ"
        "ä¸€è¡¨é€šç³»ç»Ÿ":
          collections: ["ybt_data_structure", "ybt_product_mapping"]
          latest: "ybt_data_structure"
          description: "ä¸€è¡¨é€šäº§å“æŠ¥é€ç³»ç»Ÿ"

      # ç‰ˆæœ¬æ£€æµ‹å…³é”®è¯
      version_keywords:
        explicit_version:
          "2024": ["report_1104_2024"]
          "2022": ["report_1104_2022"]
          "æœ€æ–°": ["report_1104_2024"]
          "æ–°ç‰ˆ": ["report_1104_2024"]
          "æ—§ç‰ˆ": ["report_1104_2022"]
        comparison_keywords: ["å¯¹æ¯”", "æ¯”è¾ƒ", "å·®å¼‚", "åŒºåˆ«", "å˜åŒ–", "ç›¸æ¯”"]
        ambiguous_patterns: ["æ¶‰åŠ.*è¡¨", "åŒ…å«.*è¡¨", "å“ªäº›.*è¡¨", "æŠ¥é€è¡¨.*åˆ—è¡¨"]

  # ChromaDBé…ç½®
  chromadb:
    db_path: "./data/chroma_db"
    default_collection_name: "knowledge_base"  # å…¨å±€æ£€ç´¢æ—¶ä½¿ç”¨
    persist_directory: "./data/chroma_db"

  # åµŒå…¥æ¨¡å‹é…ç½®
  embedding:
    model_path: "/Users/chongshenyang/Desktop/bge-large-zh-v1.5"
    model_type: "bge"
    device: "cpu"

  # æ–‡æ¡£é›†åˆé…ç½®
  collections:
    - name: "äººæ°‘é“¶è¡Œé‡‘èç»Ÿè®¡åˆ¶åº¦æ±‡ç¼–"
      collection_id: "pboc_statistics"
      keywords: ["äººè¡Œ", "å¤®è¡Œ", "ç»Ÿè®¡åˆ¶åº¦", "å¤§é›†ä¸­", "äººæ°‘é“¶è¡Œ", "é‡‘èç»Ÿè®¡"]
      priority: 1
      description: "äººæ°‘é“¶è¡Œé‡‘èç»Ÿè®¡åˆ¶åº¦ç›¸å…³æ–‡æ¡£"
      version: "ç°è¡Œç‰ˆ"
      version_display: "[äººæ°‘é“¶è¡Œç»Ÿè®¡åˆ¶åº¦]"
      type: "ç»Ÿè®¡åˆ¶åº¦"

    - name: "1104æŠ¥è¡¨_2024ç‰ˆ"
      collection_id: "report_1104_2024"
      keywords: ["1104", "èµ„æœ¬å……è¶³ç‡", "æŠ¥è¡¨", "2024", "æœ€æ–°ç‰ˆ"]
      priority: 1
      description: "1104æŠ¥è¡¨åˆè¾‘2024ç‰ˆ"
      version: "2024ç‰ˆ"
      version_display: "[2024ç‰ˆ]"
      type: "ç›‘ç®¡æŠ¥è¡¨"

    - name: "1104æŠ¥è¡¨_2022ç‰ˆ"
      collection_id: "report_1104_2022"
      keywords: ["1104", "èµ„æœ¬å……è¶³ç‡", "æŠ¥è¡¨", "2022", "æ—§ç‰ˆ"]
      priority: 2
      description: "1104æŠ¥è¡¨åˆè¾‘2022ç‰ˆ"
      version: "2022ç‰ˆ"
      version_display: "[2022ç‰ˆ]"
      type: "ç›‘ç®¡æŠ¥è¡¨"

    - name: "EASTæ•°æ®ç»“æ„"
      collection_id: "east_data_structure"
      keywords: ["EAST", "æ•°æ®ç»“æ„", "æ•°æ®æŠ¥é€", "æŠ¥é€ç³»ç»Ÿ"]
      priority: 1
      description: "EASTç³»ç»Ÿæ•°æ®ç»“æ„æ–‡æ¡£"
      version: "ç°è¡Œç‰ˆ"
      version_display: "[EASTæ•°æ®ç»“æ„]"
      type: "æ•°æ®ç»“æ„"

    - name: "EASTå…ƒæ•°æ®è¯´æ˜"
      collection_id: "east_metadata"
      keywords: ["EAST", "å…ƒæ•°æ®", "æ•°æ®å­—å…¸", "å­—æ®µè¯´æ˜"]
      priority: 1
      description: "EASTç³»ç»Ÿå…ƒæ•°æ®è¯´æ˜æ–‡æ¡£"
      version: "ç°è¡Œç‰ˆ"
      version_display: "[EASTå…ƒæ•°æ®]"
      type: "å…ƒæ•°æ®"

    - name: "ä¸€è¡¨é€šæ•°æ®ç»“æ„"
      collection_id: "ybt_data_structure"
      keywords: ["ä¸€è¡¨é€š", "äº§å“", "æ•°æ®ç»“æ„", "äº§å“åˆ¶åº¦"]
      priority: 1
      description: "ä¸€è¡¨é€šäº§å“æ•°æ®ç»“æ„æ–‡æ¡£"
      version: "ç°è¡Œç‰ˆ"
      version_display: "[ä¸€è¡¨é€šæ•°æ®ç»“æ„]"
      type: "æ•°æ®ç»“æ„"

    - name: "ä¸€è¡¨é€šäº§å“æŠ¥é€æ˜ å°„"
      collection_id: "ybt_product_mapping"
      keywords: ["ä¸€è¡¨é€š", "äº§å“æ˜ å°„", "æŠ¥é€æ˜ å°„", "äº§å“åˆ¶åº¦"]
      priority: 1
      description: "ä¸€è¡¨é€šäº§å“æŠ¥é€æ˜ å°„æ–‡æ¡£"
      version: "ç°è¡Œç‰ˆ"
      version_display: "[ä¸€è¡¨é€šäº§å“æ˜ å°„]"
      type: "äº§å“æ˜ å°„"



# LLMé…ç½®
llm:
  # é»˜è®¤LLMæä¾›å•†
  default_provider: "deepseek"

  # DeepSeeké…ç½®
  deepseek:
    api_key: "sk-623bd97dfce848f597f3bb8abd6a84c9"
    base_url: "https://api.deepseek.com"
    model: "deepseek-chat"
    max_tokens: 65535
    temperature: 0
    timeout: 1200

# é‡æ’å™¨é…ç½®
reranker:
  enabled: true
  type: "cross_encoder"

  cross_encoder:
    model_name: "cross-encoder/ms-marco-MiniLM-L-6-v2"
    device: "cpu"  # æˆ– "cuda" å¦‚æœæœ‰GPU
    max_length: 512
    top_k: 10  # é‡æ’åä¿ç•™çš„æ–‡æ¡£æ•°é‡

  # Qwené…ç½®ï¼ˆå¤‡ç”¨ï¼‰
  qwen:
    api_key: "sk-56b4e9f2be454d6da51430e8153eeaa3"
    base_url: "https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation"
    model: "qwen-turbo"  # qwen-turbo, qwen-plus, qwen-max
    max_tokens: 8000
    temperature: 0
    top_p: 0.8
    repetition_penalty: 1.1
    timeout: null  # ä¸è®¾ç½®è¶…æ—¶
    
  # ç”Ÿæˆå‚æ•°
  generation:
    max_retries: 3
    retry_delay: 1.0
    stream: false

# çŸ¥è¯†åº“é…ç½®
knowledge_base:
  # æ•°æ®è·¯å¾„
  chunks_dir: "./data/processed_docs/chunks"
  raw_docs_dir: "./data/KnowledgeBase"
  
  # åˆ†å—å‚æ•°
  chunk_size: 5000
  chunk_overlap: 1000
  
  # æ”¯æŒçš„æ–‡æ¡£ç±»å‹
  supported_formats:
    - "pdf"
    - "docx"
    - "xlsx"
    - "txt"
    - "md"

# æç¤ºè¯æ¨¡æ¿é…ç½®
prompts:
  # ç³»ç»Ÿæç¤ºè¯
  system_prompt: |
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é‡‘èç›‘ç®¡é¢†åŸŸæ™ºèƒ½åŠ©æ‰‹ï¼Œä¸“é—¨å›ç­”å…³äºé“¶è¡Œç›‘ç®¡æŠ¥è¡¨ã€EASTç³»ç»Ÿã€äººæ°‘é“¶è¡Œç»Ÿè®¡åˆ¶åº¦ç­‰ç›¸å…³é—®é¢˜ã€‚

    è¯·åŸºäºæä¾›çš„æ–‡æ¡£å†…å®¹ï¼Œå‡†ç¡®ã€ä¸“ä¸šåœ°å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚ç‰¹åˆ«æ³¨æ„ç‰ˆæœ¬ä¿¡æ¯çš„æ ‡æ³¨å’Œå¤„ç†ã€‚

  # ç”¨æˆ·æŸ¥è¯¢æ¨¡æ¿
  user_template: |
    === ç›¸å…³æ–‡æ¡£å†…å®¹ ===
    {context}

    === ç”¨æˆ·é—®é¢˜ ===
    {query}

    === å›ç­”è¦æ±‚ ===
    1. **ä¸¥æ ¼ç›¸å…³æ€§ç­›é€‰**ï¼šåªå›ç­”ä¸ç”¨æˆ·é—®é¢˜ç›´æ¥ç›¸å…³çš„å†…å®¹ï¼Œå¿½ç•¥ä¸ç›¸å…³çš„ä¿¡æ¯
    2. **å»é‡å¤„ç†**ï¼šå¦‚æœå¤šä¸ªæ–‡æ¡£æåˆ°ç›¸åŒçš„è¡¨æ ¼æˆ–å†…å®¹ï¼Œåªåˆ—ä¸¾ä¸€æ¬¡ï¼Œä¸è¦é‡å¤
    3. **ç²¾å‡†åŒ¹é…**ï¼šä»”ç»†åˆ†æç”¨æˆ·é—®é¢˜çš„å…³é”®è¯ï¼ŒåªåŒ…å«çœŸæ­£ç›¸å…³çš„è¡¨æ ¼å’Œä¿¡æ¯
    4. **ç‰ˆæœ¬æ ‡æ³¨**ï¼šå¦‚æœæ–‡æ¡£æ¥æºäºä¸åŒç‰ˆæœ¬ï¼Œè¯·åœ¨ç­”æ¡ˆä¸­æ˜ç¡®æ ‡æ³¨æ¯ä¸ªä¿¡æ¯çš„ç‰ˆæœ¬æ¥æº
    5. **ç®€æ´æ˜äº†**ï¼šä¼˜å…ˆæä¾›æœ€ç›¸å…³çš„å†…å®¹ï¼Œé¿å…å†—é•¿çš„åˆ—è¡¨
    6. **è´¨é‡ä¼˜äºæ•°é‡**ï¼šå®å¯å°‘è€Œç²¾ï¼Œä¸è¦å¤šè€Œæ‚
    7. å›ç­”è¦ä¸“ä¸šã€è¯¦ç»†ï¼Œé€‚åˆé‡‘èç›‘ç®¡ä»ä¸šäººå‘˜é˜…è¯»
    8. **å‚è€ƒæ–‡æ¡£æ ¼å¼è¦æ±‚**ï¼šåœ¨å›ç­”æœ«å°¾æŒ‰ä»¥ä¸‹æ ¼å¼æ³¨æ˜å‚è€ƒçš„æ–‡æ¡£æ¥æºï¼š
       ```
       ### ä¸»è¦å‚è€ƒæ–‡æ¡£
       - æ–‡æ¡£åç§°1 [ç‰ˆæœ¬ä¿¡æ¯]
       - æ–‡æ¡£åç§°2 [ç‰ˆæœ¬ä¿¡æ¯]
       ```
       ä¸è¦åªå†™"æ–‡æ¡£1ã€æ–‡æ¡£2"è¿™æ ·çš„ç¼–å·ï¼Œè¦å†™å…·ä½“çš„æ–‡æ¡£åç§°ã€‚

    **ç‰¹åˆ«æ³¨æ„**ï¼š
    - å¦‚æœç”¨æˆ·é—®çš„æ˜¯"æ™®æƒ é‡‘èé¢†åŸŸè´·æ¬¾"ï¼ŒåªåŒ…å«ä¸æ™®æƒ é‡‘èç›´æ¥ç›¸å…³çš„è¡¨æ ¼
    - å¦‚æœç”¨æˆ·é—®çš„æ˜¯ç‰¹å®šä¸»é¢˜ï¼Œä¸¥æ ¼æŒ‰ç…§è¯¥ä¸»é¢˜ç­›é€‰å†…å®¹
    - ä¸è¦ä¸ºäº†æ˜¾ç¤ºæ›´å¤šä¿¡æ¯è€ŒåŒ…å«è¾¹ç¼˜ç›¸å…³æˆ–ä¸ç›¸å…³çš„å†…å®¹
    - å‚è€ƒæ–‡æ¡£éƒ¨åˆ†å¿…é¡»å†™å…·ä½“çš„æ–‡æ¡£åç§°ï¼Œä¸èƒ½åªå†™ç¼–å·

    è¯·å¼€å§‹å›ç­”ï¼š

  # ä¸»é¢˜åˆ†ç±»LLMæ¨¡æ¿ï¼ˆç®€åŒ–ç‰ˆï¼‰
  topic_classification_template: |
    åˆ†æç”¨æˆ·æŸ¥è¯¢ï¼Œé€‰æ‹©æœ€ç›¸å…³çš„æ–‡æ¡£é›†åˆã€‚

    å¯ç”¨é›†åˆï¼š
    {collections_info}

    ç”¨æˆ·æŸ¥è¯¢ï¼š"{query}"

    è¯·è¿”å›JSONæ ¼å¼ï¼š
    {{
        "collections": ["æœ€ç›¸å…³çš„é›†åˆID"],
        "confidence": 0.85,
        "reasoning": "é€‰æ‹©ç†ç”±"
    }}

    è§„åˆ™ï¼š
    1. æœ€å¤šé€‰æ‹©2ä¸ªæœ€ç›¸å…³çš„é›†åˆ
    2. confidenceèŒƒå›´0.0-1.0
    3. å¦‚æœä¸ç¡®å®šï¼Œconfidenceè®¾ä¸º0.5ä»¥ä¸‹
    4. ä¼˜å…ˆé€‰æ‹©æœ€æ–°ç‰ˆæœ¬ï¼ˆ2024ç‰ˆä¼˜äº2022ç‰ˆï¼‰

  # ç‰ˆæœ¬æ¾„æ¸…æ¨¡æ¿
  version_clarification_template: |
    ğŸ¤” æ‚¨çš„é—®é¢˜æ¶‰åŠå¤šä¸ªç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œä¸ºäº†æä¾›æ›´å‡†ç¡®çš„ç­”æ¡ˆï¼Œè¯·æ˜ç¡®æ‚¨éœ€è¦çš„ç‰ˆæœ¬ï¼š

    ğŸ“‹ å¯ç”¨ç‰ˆæœ¬ï¼š
    {available_versions}

    ğŸ’¡ æ‚¨å¯ä»¥ï¼š
    - å›å¤æ•°å­—é€‰æ‹©ç‰¹å®šç‰ˆæœ¬
    - è¯´"å¯¹æ¯”æ‰€æœ‰ç‰ˆæœ¬"æŸ¥çœ‹ç‰ˆæœ¬å·®å¼‚
    - è¯´"æœ€æ–°ç‰ˆæœ¬"ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
    - é‡æ–°æé—®å¹¶æ˜ç¡®ç‰ˆæœ¬è¦æ±‚

    è¯·å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©ï¼š

# APIæœåŠ¡é…ç½®
api:
  host: "0.0.0.0"
  port: 8000
  debug: false
  cors_enabled: true
  rate_limit:
    enabled: true
    requests_per_minute: 60

# æ€§èƒ½ç›‘æ§é…ç½®
monitoring:
  enabled: true
  metrics_file: "logs/metrics.json"
  log_queries: true
  log_responses: false  # ä¸è®°å½•å®Œæ•´å›ç­”å†…å®¹ï¼Œä¿æŠ¤éšç§

# ç¼“å­˜é…ç½®
cache:
  enabled: true
  type: "memory"  # memory, redis
  ttl: 3600  # ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
  max_size: 1000  # æœ€å¤§ç¼“å­˜æ¡ç›®æ•°

# å®‰å…¨é…ç½®
security:
  api_key_required: false
  allowed_origins:
    - "http://localhost:3000"
    - "http://127.0.0.1:3000"
  max_query_length: 1000

# å¼€å‘é…ç½®
development:
  debug_mode: false
  verbose_logging: false
  profile_performance: false

# æ–‡æ¡£é¢„å¤„ç†é…ç½®
documents:
  preprocessing:
    enabled: true
    grobid_url: "http://localhost:8070"  # GROBID DockeræœåŠ¡åœ°å€
    grobid_timeout: 300  # GROBIDè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    ocr_pages_limit: 30  # åˆ†ææ–‡æ¡£å‰ké¡µï¼ˆå¢åŠ ä»¥è·å–å®Œæ•´ç›®å½•ï¼‰
    toc_extraction_enabled: true
    toc_confidence_threshold: 0.8  # ç›®å½•è¯†åˆ«ç½®ä¿¡åº¦é˜ˆå€¼

  # æ–‡æ¡£ç›®å½•ç»“æ„ï¼ˆTOC - Table of Contentsï¼‰
  toc:
    report_1104_2024:
      title: "é“¶è¡Œä¸šç›‘ç®¡ç»Ÿè®¡æŠ¥è¡¨åˆ¶åº¦2024ç‰ˆ"
      file_path: "data/KnowledgeBase/1104æŠ¥è¡¨åˆè¾‘ã€2024ç‰ˆã€‘.docx"
      extraction_status: "pending"  # pending | completed | failed
      last_updated: null
      chapters: []  # å°†é€šè¿‡é¢„å¤„ç†è‡ªåŠ¨å¡«å……

    report_1104_2022:
      title: "é“¶è¡Œä¸šç›‘ç®¡ç»Ÿè®¡æŠ¥è¡¨åˆ¶åº¦2022ç‰ˆ"
      file_path: "data/KnowledgeBase/1104æŠ¥è¡¨åˆè¾‘ã€2022ç‰ˆã€‘.docx"
      extraction_status: "pending"
      last_updated: null
      chapters: []

    pboc_statistics:
      title: "äººæ°‘é“¶è¡Œé‡‘èç»Ÿè®¡åˆ¶åº¦æ±‡ç¼–"
      file_path: "data/KnowledgeBase/äººæ°‘é“¶è¡Œé‡‘èç»Ÿè®¡åˆ¶åº¦æ±‡ç¼–.pdf"
      extraction_status: "pending"
      last_updated: null
      chapters: []

    east_data_structure:
      title: "EASTç³»ç»Ÿæ•°æ®ç»“æ„è¯´æ˜"
      file_path: "data/KnowledgeBase/EASTæ•°æ®ç»“æ„.xlsx"
      extraction_status: "pending"
      last_updated: null
      chapters: []

# è¯­ä¹‰å¢å¼ºæ£€ç´¢é…ç½®
semantic_enhancement:
  enabled: true
  toc_based_expansion: true  # åŸºäºç›®å½•çš„æŸ¥è¯¢æ‰©å±•
  keyword_expansion_limit: 5  # æœ€å¤šæ‰©å±•çš„å…³é”®è¯æ•°é‡
  semantic_similarity_threshold: 0.7  # è¯­ä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼

  # æŸ¥è¯¢æ„å›¾åˆ†æé…ç½®
  intent_analysis:
    enabled: true
    use_toc_context: true  # ä½¿ç”¨ç›®å½•ä¸Šä¸‹æ–‡è¿›è¡Œæ„å›¾åˆ†æ
    collection_selection_strategy: "toc_guided"  # toc_guided | similarity_based | hybrid

  # ç›®å½•åˆ†æLLMæ¨¡æ¿
  toc_analysis_prompt: |
    è¯·åˆ†æä»¥ä¸‹æ–‡æ¡£æ–‡æœ¬ï¼Œæ™ºèƒ½æå–å…¶ç›®å½•ç»“æ„ã€‚

    æ–‡æ¡£ID: {document_id}
    æ–‡æ¡£æ–‡æœ¬ï¼ˆå‰{max_pages}é¡µï¼‰:
    {text_content}

    è¯·ä»”ç»†åˆ†ææ–‡æœ¬å†…å®¹ï¼Œè¯†åˆ«æ–‡æ¡£çš„ç›®å½•ç»“æ„ã€‚æ³¨æ„ï¼š
    1. å¯»æ‰¾"ç›®å½•"ã€"CONTENTS"ç­‰æ ‡è¯†
    2. è¯†åˆ«ç« èŠ‚æ ‡é¢˜ã€ç¼–å·å’Œé¡µç 
    3. åˆ†æå±‚çº§å…³ç³»ï¼ˆç« ã€èŠ‚ã€å°èŠ‚ç­‰ï¼‰
    4. æå–å‡†ç¡®çš„æ ‡é¢˜æ–‡æœ¬

    è¯·æŒ‰ä»¥ä¸‹JSONæ ¼å¼è¿”å›ç›®å½•ç»“æ„ï¼š
    {{
        "status": "completed",
        "extraction_method": "llm_analysis",
        "confidence": 0.85,
        "chapters": [
            {{
                "chapter_num": "ç¬¬ä¸€ç« ",
                "title": "æ€»åˆ™",
                "page": 1,
                "level": 1,
                "subsections": [
                    {{
                        "chapter_num": "1.1",
                        "title": "é€‚ç”¨èŒƒå›´",
                        "page": 3,
                        "level": 2
                    }}
                ]
            }}
        ]
    }}

    è¦æ±‚ï¼š
    1. å¦‚æœæ²¡æœ‰æ˜æ˜¾ç›®å½•ç»“æ„ï¼Œè¿”å›ç©ºçš„chaptersæ•°ç»„
    2. confidenceè¡¨ç¤ºè¯†åˆ«ç½®ä¿¡åº¦ï¼ˆ0.0-1.0ï¼‰
    3. levelè¡¨ç¤ºå±‚çº§ï¼š1=ç« ï¼Œ2=èŠ‚ï¼Œ3=å°èŠ‚
    4. åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—
    5. å°½é‡å‡†ç¡®æå–é¡µç ä¿¡æ¯

  # æŸ¥è¯¢æ„å›¾åˆ†æLLMæ¨¡æ¿
  intent_analysis_prompt: |
    è¯·åˆ†æç”¨æˆ·æŸ¥è¯¢çš„æ„å›¾ï¼Œå¹¶åŸºäºå¯ç”¨çš„æ–‡æ¡£ç›®å½•ç»“æ„æä¾›æ™ºèƒ½åˆ†æã€‚

    ç”¨æˆ·æŸ¥è¯¢: {query}

    {toc_context}

    è¯·æ·±å…¥åˆ†æç”¨æˆ·æŸ¥è¯¢çš„æ„å›¾ï¼ŒåŒ…æ‹¬ï¼š
    1. æŸ¥è¯¢çš„æ ¸å¿ƒç›®çš„å’Œéœ€æ±‚
    2. æ¶‰åŠçš„ä¸šåŠ¡é¢†åŸŸå’Œä¸»é¢˜
    3. å¯èƒ½éœ€è¦çš„æ–‡æ¡£ç±»å‹
    4. å…³é”®æ¦‚å¿µå’Œä¸“ä¸šæœ¯è¯­
    5. æŸ¥è¯¢çš„å¤æ‚åº¦å’ŒèŒƒå›´

    è¯·æŒ‰ä»¥ä¸‹JSONæ ¼å¼è¿”å›åˆ†æç»“æœï¼š
    {{
        "intent": "æŸ¥è¯¢æ„å›¾çš„è¯¦ç»†æè¿°",
        "confidence": 0.85,
        "topics": ["æ™®æƒ é‡‘è", "å°å¾®ä¼ä¸š", "è´·æ¬¾ç»Ÿè®¡"],
        "concepts": ["æŠ¥é€è¡¨", "ç»Ÿè®¡æŒ‡æ ‡", "ç›‘ç®¡è¦æ±‚"],
        "document_types": ["ç»Ÿè®¡æŠ¥è¡¨", "åˆ¶åº¦æ–‡ä»¶", "æ“ä½œæŒ‡å—"],
        "complexity": "simple|medium|complex",
        "scope": "specific|broad|comprehensive"
    }}

    åˆ†æè¦æ±‚ï¼š
    1. confidenceè¡¨ç¤ºåˆ†æç½®ä¿¡åº¦ï¼ˆ0.0-1.0ï¼‰
    2. topicsåˆ—å‡ºæœ€å¤š5ä¸ªç›¸å…³ä¸»é¢˜é¢†åŸŸ
    3. conceptsåˆ—å‡ºæŸ¥è¯¢ä¸­çš„å…³é”®æ¦‚å¿µ
    4. document_typesæŒ‡å‡ºå¯èƒ½ç›¸å…³çš„æ–‡æ¡£ç±»å‹
    5. complexityè¯„ä¼°æŸ¥è¯¢å¤æ‚åº¦
    6. scopeè¯„ä¼°æŸ¥è¯¢èŒƒå›´
    7. åªè¿”å›JSONæ ¼å¼ï¼Œä¸è¦å…¶ä»–è¯´æ˜æ–‡å­—
